<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản Lý Chi Tiêu</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }
    .lucide { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
  </style>
</head>
<body>
  <div id="root"></div>

  <svg style="display: none;">
    <symbol id="icon-plus" viewBox="0 0 24 24">
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </symbol>
    <symbol id="icon-trash" viewBox="0 0 24 24">
      <polyline points="3 6 5 6 21 6"></polyline>
      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
    </symbol>
    <symbol id="icon-edit" viewBox="0 0 24 24">
      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
    </symbol>
    <symbol id="icon-check" viewBox="0 0 24 24">
      <polyline points="20 6 9 17 4 12"></polyline>
    </symbol>
    <symbol id="icon-x" viewBox="0 0 24 24">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </symbol>
    <symbol id="icon-globe" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="2" y1="12" x2="22" y2="12"></line>
      <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
    </symbol>
    <symbol id="icon-logout" viewBox="0 0 24 24">
      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
      <polyline points="16 17 21 12 16 7"></polyline>
      <line x1="21" y1="12" x2="9" y2="12"></line>
    </symbol>
    <symbol id="icon-trending-down" viewBox="0 0 24 24">
      <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
      <polyline points="17 18 23 18 23 12"></polyline>
    </symbol>
    <symbol id="icon-calendar" viewBox="0 0 24 24">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
    </symbol>
    <symbol id="icon-tag" viewBox="0 0 24 24">
      <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
      <line x1="7" y1="7" x2="7.01" y2="7"></line>
    </symbol>
  </svg>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const Icon = ({ name, className = "w-5 h-5" }) => {
      return (
        <svg className={`lucide ${className}`}>
          <use href={`#icon-${name}`} />
        </svg>
      );
    };

    const PieChart = ({ data }) => {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        if (canvasRef.current && data.length > 0) {
          const ctx = canvasRef.current.getContext('2d');
          
          if (chartRef.current) {
            chartRef.current.destroy();
          }

          chartRef.current = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: data.map(item => item.name),
              datasets: [{
                data: data.map(item => item.value),
                backgroundColor: data.map(item => item.color),
                borderWidth: 2,
                borderColor: '#fff'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      const label = context.label || '';
                      const value = context.parsed || 0;
                      const total = context.dataset.data.reduce((a, b) => a + b, 0);
                      const percentage = ((value / total) * 100).toFixed(0);
                      return `${label}: ${new Intl.NumberFormat('vi-VN').format(value)} đ (${percentage}%)`;
                    }
                  }
                }
              }
            }
          });
        }

        return () => {
          if (chartRef.current) {
            chartRef.current.destroy();
          }
        };
      }, [data]);

      return <canvas ref={canvasRef} style={{ maxWidth: '400px', maxHeight: '400px', margin: '0 auto' }}></canvas>;
    };

    const ExpenseTrackerApp = () => {
      const translations = {
        vi: {
          appName: 'Quản Lý Chi Tiêu',
          login: 'Đăng Nhập',
          register: 'Đăng Ký',
          username: 'Tên đăng nhập',
          email: 'Email',
          password: 'Mật khẩu',
          confirmPassword: 'Xác nhận mật khẩu',
          noAccount: 'Chưa có tài khoản?',
          hasAccount: 'Đã có tài khoản?',
          logout: 'Đăng xuất',
          addExpense: 'Thêm Chi Tiêu',
          amount: 'Số tiền',
          category: 'Danh mục',
          note: 'Ghi chú',
          date: 'Ngày',
          save: 'Lưu',
          cancel: 'Hủy',
          delete: 'Xóa',
          edit: 'Sửa',
          total: 'Tổng chi tiêu',
          thisMonth: 'Tháng này',
          statistics: 'Thống Kê',
          expenseList: 'Danh Sách Chi Tiêu',
          categories: 'Danh Mục',
          addCategory: 'Thêm danh mục',
          newCategory: 'Danh mục mới',
          manageCategories: 'Quản lý danh mục',
          noExpenses: 'Chưa có chi tiêu nào',
          enterAmount: 'Nhập số tiền',
          enterNote: 'Nhập ghi chú (tùy chọn)',
          selectCategory: 'Chọn danh mục',
          vnd: 'đ',
          invalidEmail: 'Email không hợp lệ',
          passwordMismatch: 'Mật khẩu không khớp',
          fillAllFields: 'Vui lòng điền đầy đủ thông tin',
          userExists: 'Tên đăng nhập đã tồn tại',
          invalidCredentials: 'Tên đăng nhập hoặc mật khẩu không đúng',
          registerSuccess: 'Đăng ký thành công!',
        },
        en: {
          appName: 'Expense Tracker',
          login: 'Login',
          register: 'Register',
          username: 'Username',
          email: 'Email',
          password: 'Password',
          confirmPassword: 'Confirm Password',
          noAccount: "Don't have an account?",
          hasAccount: 'Already have an account?',
          logout: 'Logout',
          addExpense: 'Add Expense',
          amount: 'Amount',
          category: 'Category',
          note: 'Note',
          date: 'Date',
          save: 'Save',
          cancel: 'Cancel',
          delete: 'Delete',
          edit: 'Edit',
          total: 'Total expenses',
          thisMonth: 'This month',
          statistics: 'Statistics',
          expenseList: 'Expense List',
          categories: 'Categories',
          addCategory: 'Add category',
          newCategory: 'New category',
          manageCategories: 'Manage categories',
          noExpenses: 'No expenses yet',
          enterAmount: 'Enter amount',
          enterNote: 'Enter note (optional)',
          selectCategory: 'Select category',
          vnd: 'VND',
          invalidEmail: 'Invalid email',
          passwordMismatch: 'Passwords do not match',
          fillAllFields: 'Please fill all fields',
          userExists: 'Username already exists',
          invalidCredentials: 'Invalid username or password',
          registerSuccess: 'Registration successful!',
        }
      };

      const defaultCategories = {
        vi: ['Ăn uống', 'Di chuyển', 'Mua sắm', 'Giải trí', 'Hóa đơn', 'Sức khỏe', 'Giáo dục', 'Khác'],
        en: ['Food', 'Transport', 'Shopping', 'Entertainment', 'Bills', 'Health', 'Education', 'Other']
      };

      const categoryColors = [
        '#FF6B9D', '#C44569', '#FFB84D', '#A855F7', '#3B82F6', '#10B981',
        '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4', '#F97316'
      ];

      const [language, setLanguage] = useState(() => {
        const saved = localStorage.getItem('language');
        return saved || 'vi';
      });
      
      const [currentUser, setCurrentUser] = useState(() => {
        const saved = localStorage.getItem('currentUser');
        return saved ? JSON.parse(saved) : null;
      });
      
      const [users, setUsers] = useState(() => {
        const saved = localStorage.getItem('users');
        return saved ? JSON.parse(saved) : [];
      });
      
      const [expenses, setExpenses] = useState([]);
      const [categories, setCategories] = useState(defaultCategories.vi);
      const [showExpenseForm, setShowExpenseForm] = useState(false);
      const [showCategoryManager, setShowCategoryManager] = useState(false);
      const [editingExpense, setEditingExpense] = useState(null);
      const [newCategory, setNewCategory] = useState('');
      const [isLogin, setIsLogin] = useState(true);
      const [displayAmount, setDisplayAmount] = useState('');
      const [showAddCategoryInline, setShowAddCategoryInline] = useState(false);
      const [inlineNewCategory, setInlineNewCategory] = useState('');

      const [formData, setFormData] = useState({
        username: '',
        email: '',
        password: '',
        confirmPassword: ''
      });

      const [expenseForm, setExpenseForm] = useState({
        amount: '',
        category: '',
        note: '',
        date: new Date().toISOString().split('T')[0]
      });

      const t = translations[language];

      const formatNumberInput = (value) => {
        if (!value) return '';
        const numericValue = value.toString().replace(/\D/g, '');
        return numericValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      };

      const parseFormattedNumber = (value) => {
        if (!value) return '';
        return value.toString().replace(/,/g, '');
      };

      const handleAmountChange = (value) => {
        const plainValue = parseFormattedNumber(value);
        setExpenseForm({...expenseForm, amount: plainValue});
        setDisplayAmount(formatNumberInput(plainValue));
      };

      useEffect(() => {
        if (currentUser) {
          const savedExpenses = localStorage.getItem(`expenses_${currentUser.username}`);
          const savedCategories = localStorage.getItem(`categories_${currentUser.username}`);
          
          if (savedExpenses) {
            setExpenses(JSON.parse(savedExpenses));
          } else {
            setExpenses([]);
          }
          
          if (savedCategories) {
            setCategories(JSON.parse(savedCategories));
          } else {
            setCategories(defaultCategories[language]);
          }
        }
      }, [currentUser, language]);

      useEffect(() => {
        localStorage.setItem('language', language);
      }, [language]);

      useEffect(() => {
        localStorage.setItem('users', JSON.stringify(users));
      }, [users]);

      useEffect(() => {
        if (currentUser) {
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          localStorage.setItem(`expenses_${currentUser.username}`, JSON.stringify(expenses));
        }
      }, [expenses, currentUser]);

      useEffect(() => {
        if (currentUser) {
          localStorage.setItem(`categories_${currentUser.username}`, JSON.stringify(categories));
        }
      }, [categories, currentUser]);

      const handleLanguageChange = () => {
        setLanguage(language === 'vi' ? 'en' : 'vi');
      };

      const handleRegister = (e) => {
        if (e && e.preventDefault) {
          e.preventDefault();
        }
        
        if (!formData.username || !formData.email || !formData.password || !formData.confirmPassword) {
          alert(t.fillAllFields);
          return;
        }

        if (!formData.email.includes('@')) {
          alert(t.invalidEmail);
          return;
        }

        if (formData.password !== formData.confirmPassword) {
          alert(t.passwordMismatch);
          return;
        }

        if (users.some(u => u.username === formData.username)) {
          alert(t.userExists);
          return;
        }

        const newUser = {
          username: formData.username,
          email: formData.email,
          password: formData.password
        };

        setUsers([...users, newUser]);
        alert(t.registerSuccess);
        setIsLogin(true);
        setFormData({ username: '', email: '', password: '', confirmPassword: '' });
      };

      const handleLogin = (e) => {
        if (e && e.preventDefault) {
          e.preventDefault();
        }
        
        const user = users.find(u => 
          u.username === formData.username && u.password === formData.password
        );

        if (!user) {
          alert(t.invalidCredentials);
          return;
        }

        setCurrentUser(user);
        setFormData({ username: '', email: '', password: '', confirmPassword: '' });
      };

      const handleLogout = () => {
        setCurrentUser(null);
        setExpenses([]);
        setCategories(defaultCategories[language]);
        localStorage.removeItem('currentUser');
      };

      const handleSaveExpense = (e) => {
        if (e && e.preventDefault) {
          e.preventDefault();
        }
        
        if (!expenseForm.amount || !expenseForm.category) {
          alert(t.fillAllFields);
          return;
        }

        const expense = {
          id: editingExpense?.id || Date.now(),
          amount: parseFloat(expenseForm.amount),
          category: expenseForm.category,
          note: expenseForm.note,
          date: expenseForm.date,
          timestamp: editingExpense?.timestamp || Date.now()
        };

        if (editingExpense) {
          setExpenses(expenses.map(e => e.id === expense.id ? expense : e));
        } else {
          setExpenses([...expenses, expense]);
        }
        
        setShowExpenseForm(false);
        setEditingExpense(null);
        setExpenseForm({ amount: '', category: '', note: '', date: new Date().toISOString().split('T')[0] });
        setDisplayAmount('');
        setShowAddCategoryInline(false);
        setInlineNewCategory('');
      };

      const handleDeleteExpense = (id) => {
        setExpenses(expenses.filter(e => e.id !== id));
      };

      const handleAddCategory = () => {
        if (!newCategory.trim()) return;
        
        if (categories.includes(newCategory.trim())) {
          alert(language === 'vi' ? 'Danh mục đã tồn tại' : 'Category already exists');
          return;
        }

        setCategories([...categories, newCategory.trim()]);
        setNewCategory('');
      };

      const handleAddCategoryInline = () => {
        if (!inlineNewCategory.trim()) return;
        
        if (categories.includes(inlineNewCategory.trim())) {
          alert(language === 'vi' ? 'Danh mục đã tồn tại' : 'Category already exists');
          return;
        }

        const newCat = inlineNewCategory.trim();
        setCategories([...categories, newCat]);
        setExpenseForm({...expenseForm, category: newCat});
        setInlineNewCategory('');
        setShowAddCategoryInline(false);
      };

      const handleDeleteCategory = (category) => {
        setCategories(categories.filter(c => c !== category));
      };

      const getCurrentMonthExpenses = () => {
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        
        return expenses.filter(expense => {
          const expenseDate = new Date(expense.date);
          return expenseDate.getMonth() === currentMonth && 
                 expenseDate.getFullYear() === currentYear;
        });
      };

      const getStatistics = () => {
        const monthExpenses = getCurrentMonthExpenses();
        const total = monthExpenses.reduce((sum, e) => sum + e.amount, 0);
        
        const categoryData = categories.map((cat, index) => {
          const amount = monthExpenses
            .filter(e => e.category === cat)
            .reduce((sum, e) => sum + e.amount, 0);
          
          return {
            name: cat,
            value: amount,
            color: categoryColors[index % categoryColors.length]
          };
        }).filter(item => item.value > 0);

        return { total, categoryData, expenses: monthExpenses };
      };

      const stats = getStatistics();

      const formatCurrency = (amount) => {
        return new Intl.NumberFormat('vi-VN').format(amount);
      };

      if (!currentUser) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-pink-100 via-pink-50 to-white flex items-center justify-center p-4">
            <div className="w-full max-w-md">
              <div className="bg-white rounded-3xl shadow-2xl p-8 border border-pink-100">
                <div className="flex justify-between items-center mb-8">
                  <h1 className="text-3xl font-bold bg-gradient-to-r from-pink-500 to-pink-600 bg-clip-text text-transparent">
                    {t.appName}
                  </h1>
                  <button
                    onClick={handleLanguageChange}
                    className="p-2 hover:bg-pink-50 rounded-full transition-colors"
                  >
                    <Icon name="globe" className="w-5 h-5 text-pink-500" />
                  </button>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      {t.username}
                    </label>
                    <input
                      type="text"
                      value={formData.username}
                      onChange={(e) => setFormData({...formData, username: e.target.value})}
                      onKeyPress={(e) => e.key === 'Enter' && (isLogin ? handleLogin(e) : handleRegister(e))}
                      className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all"
                      placeholder={t.username}
                    />
                  </div>

                  {!isLogin && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        {t.email}
                      </label>
                      <input
                        type="email"
                        value={formData.email}
                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                        onKeyPress={(e) => e.key === 'Enter' && handleRegister(e)}
                        className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all"
                        placeholder={t.email}
                      />
                    </div>
                  )}

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      {t.password}
                    </label>
                    <input
                      type="password"
                      value={formData.password}
                      onChange={(e) => setFormData({...formData, password: e.target.value})}
                      onKeyPress={(e) => e.key === 'Enter' && (isLogin ? handleLogin(e) : handleRegister(e))}
                      className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all"
                      placeholder={t.password}
                    />
                  </div>

                  {!isLogin && (
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        {t.confirmPassword}
                      </label>
                      <input
                        type="password"
                        value={formData.confirmPassword}
                        onChange={(e) => setFormData({...formData, confirmPassword: e.target.value})}
                        onKeyPress={(e) => e.key === 'Enter' && handleRegister(e)}
                        className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400 transition-all"
                        placeholder={t.confirmPassword}
                      />
                    </div>
                  )}

                  <button
                    onClick={isLogin ? handleLogin : handleRegister}
                    className="w-full bg-gradient-to-r from-pink-500 to-pink-600 text-white py-3 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
                  >
                    {isLogin ? t.login : t.register}
                  </button>
                </div>

                <div className="mt-6 text-center">
                  <button
                    onClick={() => {
                      setIsLogin(!isLogin);
                      setFormData({ username: '', email: '', password: '', confirmPassword: '' });
                    }}
                    className="text-pink-600 hover:text-pink-700 font-medium text-sm"
                  >
                    {isLogin ? t.noAccount : t.hasAccount} {isLogin ? t.register : t.login}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-pink-50 via-white to-pink-50">
          <div className="bg-gradient-to-r from-pink-500 to-pink-600 text-white shadow-lg">
            <div className="max-w-6xl mx-auto px-4 py-6">
              <div className="flex justify-between items-center">
                <div>
                  <h1 className="text-2xl md:text-3xl font-bold">{t.appName}</h1>
                  <p className="text-pink-100 text-sm mt-1">@{currentUser.username}</p>
                </div>
                <div className="flex gap-2">
                  <button
                    onClick={handleLanguageChange}
                    className="p-2 hover:bg-pink-600 rounded-lg transition-colors"
                  >
                    <Icon name="globe" />
                  </button>
                  <button
                    onClick={handleLogout}
                    className="flex items-center gap-2 px-4 py-2 bg-white text-pink-600 rounded-lg hover:bg-pink-50 transition-colors font-medium"
                  >
                    <Icon name="logout" className="w-4 h-4" />
                    <span className="hidden sm:inline">{t.logout}</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto px-4 py-8">
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6 border border-pink-100">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-gray-600 text-sm mb-1">{t.total} - {t.thisMonth}</p>
                  <p className="text-4xl font-bold text-pink-600">
                    {formatCurrency(stats.total)} {t.vnd}
                  </p>
                </div>
                <div className="bg-pink-100 p-4 rounded-full">
                  <Icon name="trending-down" className="w-8 h-8 text-pink-600" />
                </div>
              </div>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
              <button
                onClick={() => {
                  setShowExpenseForm(true);
                  setDisplayAmount('');
                }}
                className="bg-gradient-to-r from-pink-500 to-pink-600 text-white py-4 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 flex items-center justify-center gap-2"
              >
                <Icon name="plus" />
                {t.addExpense}
              </button>
              <button
                onClick={() => setShowCategoryManager(true)}
                className="bg-white text-pink-600 py-4 rounded-xl font-semibold hover:bg-pink-50 transition-all shadow-lg border-2 border-pink-200 flex items-center justify-center gap-2"
              >
                <Icon name="tag" />
                {t.manageCategories}
              </button>
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-6 mb-6 border border-pink-100">
              <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <Icon name="calendar" className="text-pink-600" />
                {t.statistics} - {t.thisMonth}
              </h2>
              
              {stats.categoryData.length > 0 ? (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="flex items-center justify-center">
                    <PieChart data={stats.categoryData} />
                  </div>
                  
                  <div className="space-y-3">
                    {stats.categoryData.map((item, index) => (
                      <div key={index} className="flex items-center justify-between p-3 bg-pink-50 rounded-lg">
                        <div className="flex items-center gap-3">
                          <div
                            className="w-4 h-4 rounded-full"
                            style={{ backgroundColor: item.color }}
                          />
                          <span className="font-medium text-gray-700">{item.name}</span>
                        </div>
                        <span className="font-bold text-pink-600">
                          {formatCurrency(item.value)} {t.vnd}
                        </span>
                      </div>
                    ))}
                  </div>
                </div>
              ) : (
                <p className="text-center text-gray-400 py-8">{t.noExpenses}</p>
              )}
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-6 border border-pink-100">
              <h2 className="text-xl font-bold text-gray-800 mb-4">{t.expenseList}</h2>
              
              {stats.expenses.length > 0 ? (
                <div className="space-y-3">
                  {stats.expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).map((expense) => (
                    <div
                      key={expense.id}
                      className="flex items-center justify-between p-4 bg-gradient-to-r from-pink-50 to-white rounded-xl border border-pink-100 hover:shadow-md transition-shadow"
                    >
                      <div className="flex-1">
                        <div className="flex items-center gap-2 mb-1">
                          <span className="font-semibold text-gray-800">{expense.category}</span>
                          <span className="text-gray-400 text-sm">•</span>
                          <span className="text-gray-500 text-sm">{expense.date}</span>
                        </div>
                        {expense.note && (
                          <p className="text-gray-600 text-sm">{expense.note}</p>
                        )}
                      </div>
                      <div className="flex items-center gap-3">
                        <span className="font-bold text-pink-600 text-lg">
                          {formatCurrency(expense.amount)} {t.vnd}
                        </span>
                        <button
                          onClick={() => {
                            setEditingExpense(expense);
                            setExpenseForm({
                              amount: expense.amount,
                              category: expense.category,
                              note: expense.note,
                              date: expense.date
                            });
                            setDisplayAmount(formatNumberInput(expense.amount));
                            setShowExpenseForm(true);
                          }}
                          className="p-2 hover:bg-pink-100 rounded-lg transition-colors"
                        >
                          <Icon name="edit" className="w-4 h-4 text-pink-600" />
                        </button>
                        <button
                          onClick={() => handleDeleteExpense(expense.id)}
                          className="p-2 hover:bg-red-100 rounded-lg transition-colors"
                        >
                          <Icon name="trash" className="w-4 h-4 text-red-500" />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <p className="text-center text-gray-400 py-8">{t.noExpenses}</p>
              )}
            </div>
          </div>

          {showExpenseForm && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                <h3 className="text-2xl font-bold text-gray-800 mb-6">
                  {editingExpense ? t.edit : t.addExpense}
                </h3>
                
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      {t.amount}
                    </label>
                    <input
                      type="text"
                      value={displayAmount}
                      onChange={(e) => handleAmountChange(e.target.value)}
                      className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400"
                      placeholder={t.enterAmount}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      {t.category}
                    </label>
                    
                    {!showAddCategoryInline ? (
                      <div className="space-y-2">
                        <select
                          value={expenseForm.category}
                          onChange={(e) => {
                            if (e.target.value === '__add_new__') {
                              setShowAddCategoryInline(true);
                            } else {
                              setExpenseForm({...expenseForm, category: e.target.value});
                            }
                          }}
                          className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400"
                        >
                          <option value="">{t.selectCategory}</option>
                          {categories.map((cat, index) => (
                            <option key={index} value={cat}>{cat}</option>
                          ))}
                          <option value="__add_new__">+ {t.addCategory}</option>
                        </select>
                      </div>
                    ) : (
                      <div className="space-y-2">
                        <div className="flex gap-2">
                          <input
                            type="text"
                            value={inlineNewCategory}
                            onChange={(e) => setInlineNewCategory(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleAddCategoryInline()}
                            className="flex-1 px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400"
                            placeholder={t.newCategory}
                            autoFocus
                          />
                          <button
                            onClick={handleAddCategoryInline}
                            className="bg-gradient-to-r from-pink-500 to-pink-600 text-white px-4 py-3 rounded-xl hover:from-pink-600 hover:to-pink-700 transition-all"
                          >
                            <Icon name="check" />
                          </button>
                          <button
                            onClick={() => {
                              setShowAddCategoryInline(false);
                              setInlineNewCategory('');
                            }}
                            className="bg-gray-100 text-gray-700 px-4 py-3 rounded-xl hover:bg-gray-200 transition-all"
                          >
                            <Icon name="x" />
                          </button>
                        </div>
                      </div>
                    )}
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      {t.date}
                    </label>
                    <input
                      type="date"
                      value={expenseForm.date}
                      onChange={(e) => setExpenseForm({...expenseForm, date: e.target.value})}
                      className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      {t.note}
                    </label>
                    <textarea
                      value={expenseForm.note}
                      onChange={(e) => setExpenseForm({...expenseForm, note: e.target.value})}
                      className="w-full px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400 resize-none"
                      rows="3"
                      placeholder={t.enterNote}
                    />
                  </div>

                  <div className="flex gap-3 pt-4">
                    <button
                      onClick={handleSaveExpense}
                      className="flex-1 bg-gradient-to-r from-pink-500 to-pink-600 text-white py-3 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all flex items-center justify-center gap-2"
                    >
                      <Icon name="check" />
                      {t.save}
                    </button>
                    <button
                      type="button"
                      onClick={() => {
                        setShowExpenseForm(false);
                        setEditingExpense(null);
                        setExpenseForm({ amount: '', category: '', note: '', date: new Date().toISOString().split('T')[0] });
                        setDisplayAmount('');
                        setShowAddCategoryInline(false);
                        setInlineNewCategory('');
                      }}
                      className="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 transition-all flex items-center justify-center gap-2"
                    >
                      <Icon name="x" />
                      {t.cancel}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          )}

          {showCategoryManager && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <h3 className="text-2xl font-bold text-gray-800 mb-6">{t.manageCategories}</h3>
                
                <div className="mb-6">
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={newCategory}
                      onChange={(e) => setNewCategory(e.target.value)}
                      className="flex-1 px-4 py-3 border border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-400"
                      placeholder={t.newCategory}
                      onKeyPress={(e) => e.key === 'Enter' && handleAddCategory()}
                    />
                    <button
                      onClick={handleAddCategory}
                      className="bg-gradient-to-r from-pink-500 to-pink-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-pink-600 hover:to-pink-700 transition-all"
                    >
                      <Icon name="plus" />
                    </button>
                  </div>
                </div>

                <div className="space-y-2 mb-6 max-h-96 overflow-y-auto">
                  {categories.map((cat, index) => (
                    <div
                      key={index}
                      className="flex items-center justify-between p-3 bg-pink-50 rounded-lg"
                    >
                      <span className="font-medium text-gray-700">{cat}</span>
                      <button
                        onClick={() => handleDeleteCategory(cat)}
                        className="p-2 hover:bg-red-100 rounded-lg transition-colors"
                      >
                        <Icon name="trash" className="w-4 h-4 text-red-500" />
                      </button>
                    </div>
                  ))}
                </div>

                <button
                  onClick={() => {
                    setShowCategoryManager(false);
                    setNewCategory('');
                  }}
                  className="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 transition-all"
                >
                  {t.cancel}
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<ExpenseTrackerApp />, document.getElementById('root'));
  </script>
</body>
</html>
